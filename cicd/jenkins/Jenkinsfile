pipeline {
  agent any

  environment {
    IMAGE_NAME = "flask-todo-app"
    IMAGE_TAG  = "v1"
    LOCAL_REGISTRY = "localhost:5001"
  }

  stages {

    stage('üì• Clone Backend Code') {
      steps {
        echo "Cloning backend code"
        sh 'ls -l dev/bkend/app'
      }
    }

    stage('üê≥ Build Docker Image') {
      steps {
        script {
          dir('dev/bkend/app') {
            sh "docker build -t ${IMAGE_NAME}:${IMAGE_TAG} ."
          }
        }
      }
    }

    stage('üì¶ Push to Local Registry') {
      steps {
        script {
          // Tag the image to point to local registry
          sh "docker tag ${IMAGE_NAME}:${IMAGE_TAG} ${LOCAL_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG}"
          
          // Push the image to local registry
          sh "docker push ${LOCAL_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG}"
        }
      }
    }

    stage('‚úÖ Done') {
      steps {
        echo "Image pushed to local registry successfully!"
      }
    }

  }
}
